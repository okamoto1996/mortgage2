<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#000000">
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="‰ΩèÂÆÖ„É≠„Éº„É≥ÁÆ°ÁêÜ">
<title>‰ΩèÂÆÖ„É≠„Éº„É≥ÁÆ°ÁêÜ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;600&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0c0a;
    --surface: #1a1816;
    --surface2: #232120;
    --surface3: #2c2a28;
    --border: #383532;
    --border2: #454240;
    --accent: #d4b478;
    --accent2: #f0d080;
    --text: #f5f2ea;
    --text2: #d0cbbf;
    --muted: #9a9488;
    --danger: #e07868;
    --safe: #6ec496;
    --interest: #e07868;
    --principal: #d4b478;
    --info: #6a9ed8;
    --radius: 10px;
    --radius-sm: 6px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html { font-size: 105%; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Serif JP', serif;
    min-height: 100vh;
    padding: 20px 8px 48px;
    max-width: 680px;
    margin: 0 auto;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  .header {
    text-align: center; margin-bottom: 28px; padding: 28px 0 22px;
    border-bottom: 1px solid var(--border);
  }
  .header h1 {
    font-size: 1.45rem; font-weight: 300; color: var(--accent2);
    letter-spacing: 0.18em;
  }
  .header p { color: var(--muted); font-size: 0.75rem; margin-top: 6px; letter-spacing: 0.05em; }

  /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
  .card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: var(--radius); padding: 18px 12px;  margin-bottom: 14px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.25);
  }
  .card-title {
    font-size: 0.68rem; color: var(--accent); letter-spacing: 0.18em; text-transform: uppercase;
    margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center; gap: 8px;
  }

  /* ‚îÄ‚îÄ Forms ‚îÄ‚îÄ */
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

  .form-group { display: flex; flex-direction: column; gap: 5px; min-width: 0; }
  .form-group label { font-size: 0.68rem; color: var(--muted); letter-spacing: 0.04em; }
  .form-group input, .form-group select {
    background: var(--surface2); border: 1px solid var(--border2); border-radius: var(--radius-sm);
    color: var(--text); padding: 9px 11px; font-family: 'DM Mono', monospace;
    font-size: 0.88rem; outline: none; transition: border-color 0.2s, background 0.2s;
    width: 100%; box-sizing: border-box; -webkit-appearance: none;
  }
  .form-group input:focus, .form-group select:focus {
    border-color: var(--accent); background: var(--surface3);
  }
  .form-group select { cursor: pointer; }

  .checkbox-group {
    display: flex; align-items: flex-start; gap: 10px; margin-top: 6px;
    padding: 10px 12px; background: rgba(200,169,110,0.04);
    border-radius: var(--radius-sm); border: 1px solid var(--border);
  }
  .checkbox-group input[type="checkbox"] { width: auto; margin: 2px 0 0; flex-shrink: 0; cursor: pointer; }
  .checkbox-group label { font-size: 0.78rem; color: var(--text2); cursor: pointer; line-height: 1.4; }
  .rule-desc { font-size: 0.67rem; color: var(--muted); margin: 4px 0 0 22px; line-height: 1.5; }

  /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
  .btn {
    background: var(--accent); color: #0d0c0a; border: none; border-radius: var(--radius-sm);
    padding: 11px 24px; font-family: 'Noto Serif JP', serif; font-size: 0.88rem;
    font-weight: 600; cursor: pointer; transition: background 0.18s, transform 0.1s;
    width: 100%; margin-top: 12px; letter-spacing: 0.05em;
  }
  .btn:hover { background: var(--accent2); }
  .btn:active { transform: scale(0.98); }
  .btn-outline {
    background: transparent; border: 1px solid var(--border2); color: var(--text2);
    border-radius: var(--radius-sm); padding: 7px 14px; font-family: 'Noto Serif JP', serif;
    font-size: 0.75rem; cursor: pointer; transition: all 0.18s; width: 100%;
    text-align: left;
  }
  .btn-outline:hover { border-color: var(--accent); color: var(--accent); background: rgba(200,169,110,0.05); }

  /* ‚îÄ‚îÄ Banner ‚îÄ‚îÄ */
  .total-cost-banner {
    background: linear-gradient(135deg, rgba(200,169,110,0.12), rgba(200,169,110,0.06));
    border: 1px solid rgba(200,169,110,0.35);
    border-radius: var(--radius); padding: 18px 16px; margin-bottom: 14px; text-align: center;
  }
  .total-cost-label { font-size: 0.7rem; color: var(--accent); margin-bottom: 6px; letter-spacing: 0.1em; }
  .total-cost-value { font-family: 'DM Mono', monospace; font-size: 2rem; color: var(--accent2); font-weight: 500; line-height: 1; }
  .total-cost-detail { font-size: 0.72rem; color: var(--muted); margin-top: 8px; }
  .total-cost-detail span { color: var(--text2); font-weight: 500; }

  /* ‚îÄ‚îÄ Stats ‚îÄ‚îÄ */
  .stats-section-label {
    font-size: 0.65rem; color: var(--muted); margin: 14px 0 8px 2px;
    padding-left: 8px; border-left: 2px solid var(--accent); letter-spacing: 0.06em;
  }
  .stats-grid-4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 10px; }
  @media (max-width: 580px) { .stats-grid-4 { grid-template-columns: repeat(2,1fr); } }
  .stats-grid-3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin-bottom: 10px; }

  .stat-box {
    background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm);
    padding: 12px 6px 10px; text-align: center; display: flex; flex-direction: column;
  }
  .stat-label { font-size: 0.65rem; color: #c0bab2; font-weight: 700; margin-bottom: 8px; line-height: 1.4; min-height: 2.7em; display:flex; align-items:center; justify-content:center; letter-spacing: 0.02em; }
  .stat-value { font-family: 'DM Mono', monospace; font-size: 0.95rem; color: var(--text); font-weight: 500; min-height: 1.3em; display:flex; align-items:center; justify-content:center; }
  .stat-value.accent { color: var(--accent2); }
  .stat-value.danger { color: var(--danger); }
  .stat-sub { font-size: 0.62rem; color: #a8a39a; margin-top: auto; padding-top: 6px; line-height: 1.35; min-height: 2.4em; }

  /* ‚îÄ‚îÄ Progress ‚îÄ‚îÄ */
  .progress-bar { background: var(--surface3); border-radius: 3px; height: 5px; overflow: hidden; margin: 12px 0 6px; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2)); border-radius: 3px; transition: width 0.6s ease; }
  .progress-labels { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--muted); }

  /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
  .tabs { display: flex; gap: 3px; margin-bottom: 14px; background: var(--surface2); border-radius: var(--radius-sm); padding: 3px; }
  .tab {
    flex: 1; padding: 7px 4px; background: transparent; border: none; border-radius: 4px;
    color: var(--muted); cursor: pointer; font-size: 0.68rem; text-align: center;
    transition: all 0.18s; font-family: 'Noto Serif JP', serif;
  }
  .tab.active { background: var(--surface); color: var(--accent2); font-weight: 600; box-shadow: 0 1px 4px rgba(0,0,0,0.3); }
  .tab:hover:not(.active) { color: var(--text2); }

  .tools-tabs { display: flex; border-bottom: 1px solid var(--border); margin-bottom: 14px; }
  .tools-tab { flex: 1; padding: 9px 4px; text-align: center; font-size: 0.72rem; color: var(--muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.18s; }
  .tools-tab.active { color: var(--accent); border-bottom-color: var(--accent); font-weight: 600; }

  /* ‚îÄ‚îÄ Table ‚îÄ‚îÄ */
  .table-wrap { overflow-y: auto; max-height: 420px; border-radius: var(--radius-sm); border: 1px solid var(--border); }
  table { width: 100%; table-layout: fixed; border-collapse: collapse; }
  th {
    background: var(--surface3); padding: 9px 6px; text-align: center; color: #9a9590;
    font-weight: 600; font-size: 0.58rem; position: sticky; top: 0; z-index: 1;
    white-space: nowrap; overflow: hidden; letter-spacing: 0.03em;
  }
  th:first-child { text-align: center; padding-left: 6px; }
  th:last-child { padding-right: 10px; }
  td {
    padding: 7px 6px; text-align: right; border-bottom: 1px solid var(--border);
    font-family: 'DM Mono', monospace; font-size: 0.64rem; color: #e8e4da;
    overflow: hidden;
  }
  td:first-child {
    text-align: left; color: #b8b4ac; font-family: 'Noto Serif JP', serif;
    font-size: 0.6rem; padding-left: 10px; overflow: hidden;
    white-space: normal; word-break: keep-all;
  }
  td:last-child { padding-right: 10px; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: rgba(255,255,255,0.025); }
  tr.highlight td { background: rgba(200,169,110,0.09); }
  tr.highlight td:first-child { color: var(--accent2); font-weight: 600; }
  tr.highlight td:not(:first-child) { color: #f5f0e4; }
  th { border-right: 1px solid var(--border); }
  th:last-child { border-right: none; }
  td { border-right: 1px solid var(--border); }
  td:last-child { border-right: none; }
  tr.highlight td { border-right-color: rgba(212,180,120,0.25); }
  tr.rate-change td:first-child { color: #80e8b4; }
  tr.rate-change td { background: rgba(110,196,150,0.08); }
  tr.payment-change td { background: rgba(212,180,120,0.07); }

  /* ‚îÄ‚îÄ Rate changes ‚îÄ‚îÄ */
  .rate-section { margin-top: 18px; padding-top: 14px; border-top: 1px solid var(--border); }
  .rate-section-header {
    display: flex; justify-content: space-between; align-items: center;
    gap: 10px; margin-bottom: 10px;
  }
  .rate-section-title {
    font-size: 0.78rem; color: var(--accent); font-weight: 600;
    white-space: nowrap; flex-shrink: 0;
  }
  .rate-section-add-btn {
    background: var(--surface3); border: 1px solid var(--border2); color: var(--accent);
    border-radius: var(--radius-sm); padding: 6px 14px; font-family: 'Noto Serif JP', serif;
    font-size: 0.75rem; cursor: pointer; transition: all 0.18s; white-space: nowrap;
    flex-shrink: 0;
  }
  .rate-section-add-btn:hover { background: rgba(200,169,110,0.12); border-color: var(--accent); }
  .rate-change-item {
    display: flex; align-items: center; gap: 8px; padding: 10px 12px; margin-bottom: 6px;
    background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm);
  }
  .rate-item-main { flex: 1; display: flex; flex-direction: column; gap: 3px; }
  .rate-item-date { font-family: 'DM Mono', monospace; font-size: 0.82rem; color: var(--text); }
  .rate-item-val { font-size: 0.68rem; color: var(--safe); }
  .rate-add-form {
    display: none; background: var(--surface2); border: 1px solid var(--accent);
    border-radius: var(--radius-sm); padding: 14px; margin: 8px 0;
  }
  .rate-actions { display: flex; gap: 6px; }


  /* ‚îÄ‚îÄ Misc small components ‚îÄ‚îÄ */
  .btn-sm {
    background: var(--surface3); border: 1px solid var(--border2); border-radius: 4px;
    color: var(--muted); padding: 5px 10px; font-size: 0.7rem; cursor: pointer;
    transition: all 0.18s; font-family: 'Noto Serif JP', serif;
  }
  .btn-sm.edit:hover { border-color: var(--accent); color: var(--accent); }
  .btn-sm.danger:hover { border-color: var(--danger); color: var(--danger); }

  .chart-wrapper { position: relative; height: 240px; width: 100%; }
  canvas { display: block; width: 100%; }
  .empty-state { text-align: center; color: var(--muted); padding: 20px; font-size: 0.82rem; }
  .save-notice { font-size: 0.68rem; color: var(--safe); margin-top: 8px; text-align: center; display: none; }
  #results { display: none; }
  #results.visible { display: block; }

  .badge-warn {
    display: inline-block; background: rgba(192,104,88,0.12); color: var(--danger);
    padding: 2px 5px; border-radius: 3px; font-size: 0.6rem; border: 1px solid rgba(192,104,88,0.4);
  }
  .badge-rule {
    display: inline-block; background: rgba(94,160,130,0.12); color: var(--safe);
    padding: 2px 5px; border-radius: 3px; font-size: 0.6rem; border: 1px solid rgba(94,160,130,0.4);
  }
  .deferred-interest {
    color: var(--danger); font-size: 0.73rem; margin-top: 8px; padding: 8px 12px;
    border: 1px solid rgba(192,104,88,0.4); border-radius: var(--radius-sm);
    background: rgba(192,104,88,0.06); display: none;
  }

  .tool-content { display: none; animation: fadeIn 0.25s ease; }
  .tool-content.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

  .tool-summary {
    background: rgba(94,160,130,0.08); border: 1px solid rgba(94,160,130,0.3);
    border-radius: var(--radius-sm); padding: 14px; margin-top: 14px; text-align: center;
  }
  .tool-summary-label { font-size: 0.68rem; color: var(--safe); margin-bottom: 5px; letter-spacing: 0.04em; }
  .tool-summary-val { font-size: 1.18rem; font-family: 'DM Mono', monospace; color: var(--text); }

  .refi-row { display: flex; justify-content: space-between; border-bottom: 1px solid var(--border); padding: 7px 0; font-size: 0.78rem; }
  .refi-row span:last-child { font-family: 'DM Mono', monospace; }
  .refi-row.has-sub { border-bottom: none; padding-bottom: 3px; }
  .refi-row.sub { border-bottom: none; padding: 2px 0 2px 12px; font-size: 0.7rem; color: var(--muted); }
  .refi-row.sub-last { border-bottom: 1px solid var(--border); padding-bottom: 7px; }
  .refi-diff { font-weight: bold; }
  .refi-diff.plus { color: var(--safe); }
  .refi-diff.minus { color: var(--danger); }

  .tax-badge {
    display: inline-block; padding: 3px 9px; border-radius: var(--radius-sm);
    font-size: 0.68rem; font-weight: 600; letter-spacing: 0.02em;
  }
  .tax-short { background: rgba(192,104,88,0.12); color: var(--danger); border: 1px solid rgba(192,104,88,0.4); }
  .tax-long  { background: rgba(94,160,130,0.12); color: var(--safe);   border: 1px solid rgba(94,160,130,0.4); }
  .tax-reduced { background: rgba(82,130,184,0.12); color: var(--info);  border: 1px solid rgba(82,130,184,0.4); }

  .calc-breakdown { margin-top: 14px; }
  .step-box {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: var(--radius-sm); padding: 12px 14px; margin-bottom: 10px;
  }
  .step-title { font-size: 0.72rem; color: var(--accent); font-weight: 600; margin-bottom: 9px; display: flex; align-items: center; gap: 7px; }
  .step-num {
    background: var(--accent); color: var(--bg); border-radius: 50%; width: 17px; height: 17px;
    display: flex; align-items: center; justify-content: center; font-size: 0.62rem; font-weight: bold; flex-shrink: 0;
  }
  .step-row { display: flex; justify-content: space-between; margin-bottom: 4px; font-size: 0.73rem; color: var(--text); }
  .step-row.sub { padding-left: 11px; color: var(--muted); font-size: 0.68rem; }
  .step-row.result { border-top: 1px dashed var(--border2); margin-top: 6px; padding-top: 6px; font-weight: bold; color: var(--accent2); }
  .step-row span:last-child { font-family: 'DM Mono', monospace; text-align: right; min-width: 80px; }

  /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
  .footer-links { margin-top: 32px; padding: 18px 0 40px; border-top: 1px solid var(--border); text-align: center; }
  .external-link {
    display: inline-flex; align-items: center; gap: 5px;
    font-size: 0.72rem; color: var(--muted); text-decoration: none; transition: color 0.2s;
  }
  .external-link:hover { color: var(--accent); }
  .external-link::before { content: 'üîó'; font-size: 0.75rem; }

  /* ‚îÄ‚îÄ Validation ‚îÄ‚îÄ */
  .field-error { font-size: 0.67rem; color: var(--danger); margin-top: 2px; display: none; }
  .field-error.show { display: block; }
  .input-error { border-color: var(--danger) !important; }

  /* ‚îÄ‚îÄ Prepayment ‚îÄ‚îÄ */
  .prepay-type-row { display: flex; gap: 8px; margin-bottom: 14px; }
  .prepay-type-btn {
    flex: 1; padding: 10px 6px; background: var(--surface2); border: 1px solid var(--border2);
    border-radius: var(--radius-sm); color: var(--muted); cursor: pointer; font-size: 0.75rem;
    text-align: center; transition: all 0.18s; font-family: 'Noto Serif JP', serif; line-height: 1.4;
  }
  .prepay-type-btn.active {
    background: rgba(200,169,110,0.1); border-color: var(--accent); color: var(--accent2); font-weight: 600;
  }
  .prepay-result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 14px; }
  .prepay-result-box {
    background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm);
    padding: 12px; text-align: center;
  }
  .prepay-result-box.highlight { border-color: rgba(94,160,130,0.5); background: rgba(94,160,130,0.06); }
  .prepay-result-label { font-size: 0.65rem; color: var(--muted); margin-bottom: 6px; }
  .prepay-result-val { font-family: 'DM Mono', monospace; font-size: 1rem; color: var(--text); }
  .prepay-result-val.green { color: var(--safe); }
  .prepay-result-val.gold { color: var(--accent2); }

  /* ‚îÄ‚îÄ Breakeven box ‚îÄ‚îÄ */
  .breakeven-box {
    background: rgba(82,130,184,0.07); border: 1px solid rgba(82,130,184,0.35);
    border-radius: var(--radius-sm); padding: 14px 16px; margin-top: 12px; display: none;
  }
  .breakeven-label { font-size: 0.68rem; color: var(--info); margin-bottom: 5px; }
  .breakeven-val { font-family: 'DM Mono', monospace; font-size: 1.05rem; color: var(--text); }

  /* ‚îÄ‚îÄ Collapsible ‚îÄ‚îÄ */
  .collapsible-header {
    display: flex; justify-content: space-between; align-items: center;
    cursor: pointer; user-select: none; -webkit-user-select: none;
    margin: -18px -12px; padding: 18px 12px;
    border-radius: var(--radius) var(--radius) 0 0;
  }
  .collapsible-header:hover { background: rgba(255,255,255,0.02); }
  .collapsible-header:hover .collapse-icon { color: var(--accent2); }
  .collapse-icon { font-size: 1rem; color: var(--muted); transition: transform 0.25s ease; flex-shrink: 0; margin-left: 8px; }
  .collapse-icon.open { transform: rotate(180deg); }
  .collapsible-body { overflow: hidden; transition: max-height 0.35s ease, opacity 0.25s ease; max-height: 0; opacity: 0; pointer-events: none; }
  .collapsible-body.open { max-height: 9999px; opacity: 1; pointer-events: auto; padding-top: 18px; }

  /* ‚îÄ‚îÄ Share notice ‚îÄ‚îÄ */
  .share-notice { font-size: 0.7rem; color: var(--safe); margin-top: 6px; text-align: center; display: none; }

  /* ‚îÄ‚îÄ PWA Banner ‚îÄ‚îÄ */
  #pwaInstallBanner {
    display: none; position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%);
    background: var(--surface); border: 1px solid var(--accent); border-radius: var(--radius);
    padding: 12px 16px; z-index: 999; box-shadow: 0 4px 24px rgba(0,0,0,0.6);
    text-align: center; width: calc(100% - 32px); max-width: 420px;
  }
  #pwaInstallBanner p { font-size: 0.76rem; color: var(--text2); margin-bottom: 10px; }
  #pwaInstallBanner .pwa-btns { display: flex; gap: 8px; }

  /* ‚îÄ‚îÄ Share Modal ‚îÄ‚îÄ */
  .share-modal-overlay {
    display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75);
    z-index: 2000; align-items: center; justify-content: center; padding: 16px;
  }
  .share-modal-overlay.open { display: flex; }
  .share-modal {
    background: var(--surface); border: 1px solid var(--border2); border-radius: var(--radius);
    padding: 20px; width: 100%; max-width: 420px; box-shadow: 0 8px 40px rgba(0,0,0,0.6);
    animation: fadeIn 0.2s ease;
    max-height: 90vh; display: flex; flex-direction: column;
  }
  .share-modal-title { font-size: 0.8rem; color: var(--accent2); font-weight: 700; margin-bottom: 14px; letter-spacing: 0.06em; flex-shrink: 0; }
  .share-preview {
    width: 100%; border-radius: var(--radius-sm); overflow-y: auto; overflow-x: hidden;
    margin-bottom: 12px; border: 1px solid var(--border);
    flex: 1; min-height: 80px; max-height: 50vh;
  }
  .share-preview img { width: 100%; display: block; }
  .share-preview-loading {
    height: 120px; display: flex; align-items: center; justify-content: center;
    co