<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¿”æ¸ˆé¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;600&family=DM+Mono:wght@300;400;500&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080807;
  --surface: #111010;
  --surface2: #191817;
  --surface3: #202020;
  --border: #2a2826;
  --border2: #3a3835;
  --text: #f0ece2;
  --text2: #c8c2b4;
  --muted: #7a7468;
  --gold: #d4a84b;
  --gold2: #f2c96e;
  --radius: 8px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 100%; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Noto Serif JP', serif;
  min-height: 100vh;
  padding: 0 0 60px;
  max-width: 760px;
  margin: 0 auto;
}

/* â”€â”€ HERO â”€â”€ */
.hero {
  position: relative;
  padding: 44px 16px 32px;
  overflow: hidden;
  border-bottom: 1px solid var(--border);
}
.hero-bg {
  position: absolute; inset: 0;
  background:
    radial-gradient(ellipse 60% 80% at 20% 50%, rgba(74,158,255,0.06) 0%, transparent 60%),
    radial-gradient(ellipse 40% 60% at 80% 30%, rgba(212,168,75,0.07) 0%, transparent 50%);
}
.hero-grid {
  position: absolute; inset: 0;
  background-image:
    linear-gradient(rgba(212,168,75,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(212,168,75,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
}
.hero-back {
  position: relative;
  display: inline-flex; align-items: center; gap: 7px;
  font-size: 0.7rem; color: var(--muted); letter-spacing: 0.08em;
  text-decoration: none; margin-bottom: 24px; transition: color 0.2s;
}
.hero-back:hover { color: var(--gold); }
.hero-back::before { content: 'â†'; font-size: 0.9rem; }
.hero-inner { position: relative; }
.hero-label {
  font-size: 0.6rem; letter-spacing: 0.28em; color: var(--gold);
  text-transform: uppercase; margin-bottom: 10px;
  display: flex; align-items: center; gap: 10px;
}
.hero-label::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(90deg, rgba(212,168,75,0.35), transparent);
  max-width: 80px;
}
.hero h1 {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 3rem; font-weight: 400; letter-spacing: 0.08em; line-height: 1;
  background: linear-gradient(135deg, #f2c96e 0%, #fff5d8 40%, #c8952a 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; margin-bottom: 14px;
}
.hero-sub {
  font-size: 0.7rem; color: var(--muted); letter-spacing: 0.06em;
  display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
}
.hero-sub span::before { content: 'â€¢ '; color: var(--gold); opacity: 0.5; }

/* â”€â”€ LAYOUT â”€â”€ */
.main { padding: 0 8px; }
.panel {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); padding: 18px 14px; margin: 14px 0;
}
.panel-title {
  font-size: 0.6rem; letter-spacing: 0.2em; color: var(--gold);
  text-transform: uppercase; margin-bottom: 14px;
  padding-bottom: 9px; border-bottom: 1px solid var(--border);
}

/* â”€â”€ FORMS â”€â”€ */
.form-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 16px; }
.form-group { display: flex; flex-direction: column; gap: 5px; min-width: 0; }
.form-group label { font-size: 0.63rem; color: var(--muted); letter-spacing: 0.04em; }
.form-group input, .form-group select {
  background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 5px; color: var(--text); padding: 9px 10px;
  font-family: 'DM Mono', monospace; font-size: 0.88rem; outline: none;
  transition: border-color 0.2s; width: 100%; -webkit-appearance: none;
}
.form-group input:focus, .form-group select:focus { border-color: var(--gold); }

/* â”€â”€ RATESET â”€â”€ */
.rateset-label {
  font-size: 0.6rem; letter-spacing: 0.16em; color: var(--gold);
  text-transform: uppercase; margin-bottom: 8px;
}
.rateset-desc {
  font-size: 0.63rem; color: var(--muted); margin-bottom: 10px; line-height: 1.6;
}
.rateset-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.rateset-item {
  display: flex; align-items: center; gap: 6px;
  background: var(--surface2); border: 1px solid var(--border2);
  border-radius: 6px; padding: 7px 10px; width: 100%;
}
.rateset-color { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.rateset-input {
  width: 46px; background: var(--surface3); border: 1px solid var(--border2);
  border-radius: 4px; color: var(--text); padding: 4px 6px;
  font-family: 'DM Mono', monospace; font-size: 0.88rem; text-align: right; outline: none;
}
.rateset-input:focus { border-color: var(--gold); }
.rateset-pct { font-size: 0.7rem; color: var(--muted); }
.rateset-del {
  background: transparent; border: none; cursor: pointer; padding: 1px 4px;
  font-size: 0.75rem; color: var(--muted); line-height: 1; transition: color 0.15s;
}
.rateset-del:hover { color: #e07080; }
.rateset-add {
  display: flex; align-items: center; gap: 5px;
  background: transparent; border: 1px dashed var(--border2);
  border-radius: 6px; padding: 7px 12px; cursor: pointer;
  color: var(--muted); font-size: 0.7rem; font-family: 'Noto Serif JP', serif;
  transition: all 0.2s;
}
.rateset-add:hover { border-color: var(--gold); color: var(--gold); }

/* â”€â”€ BUTTON â”€â”€ */
.btn-calc {
  background: var(--gold); color: #090807; border: none;
  border-radius: 5px; padding: 12px; font-family: 'Noto Serif JP', serif;
  font-size: 0.88rem; font-weight: 600; cursor: pointer; width: 100%;
  margin-top: 16px; letter-spacing: 0.05em; transition: background 0.18s;
}
.btn-calc:hover { background: var(--gold2); }

/* â”€â”€ TABLE PANEL â”€â”€ */
#tablePanel { display: none; }
#tablePanel.visible { display: block; }
.section-label {
  font-size: 0.58rem; letter-spacing: 0.22em; color: var(--gold);
  text-transform: uppercase; padding-left: 9px; border-left: 2px solid var(--gold);
  margin: 20px 0 10px;
}
.table-desc {
  font-size: 0.63rem; color: var(--muted); padding: 0 12px 12px; line-height: 1.6;
}

/* â”€â”€ SENSITIVITY TABLE â”€â”€ */
.sens-outer {
  overflow-x: auto;
  border-radius: 0 0 var(--radius) var(--radius);
}
.sens-table {
  width: 100%; border-collapse: collapse;
  /* min-widthã¯JSå´ã§ãƒ˜ãƒƒãƒ€ãƒ¼åˆ—æ•°ã«å¿œã˜ã¦å‹•çš„è¨­å®š */
}
/* sticky header */
.sens-table thead th {
  background: var(--surface2);
  padding: 8px 8px; text-align: right;
  color: var(--muted); font-weight: 600;
  font-size: 0.56rem; letter-spacing: 0.03em;
  border-bottom: 2px solid var(--border2);
  white-space: nowrap;
}
.sens-table thead th:first-child {
  text-align: left;
}
/* è¿”æ¸ˆç‡åˆ—ãƒ˜ãƒƒãƒ€ãƒ¼ã®è‰²å¸¯ */
.th-r0 { border-top: 3px solid #4a9eff; }
.th-r1 { border-top: 3px solid #6ec496; }
.th-r2 { border-top: 3px solid #f0c060; }
/* è¿”æ¸ˆç‡åˆ—åŒºåˆ‡ã‚Š */
.th-sep { border-left: 1px solid var(--border2); }
.td-sep { border-left: 1px solid var(--border); }

.sens-table tbody td {
  padding: 5px 8px; border-bottom: 1px solid var(--border);
  text-align: right; font-family: 'DM Mono', monospace; font-size: 0.65rem;
  white-space: nowrap;
}
.sens-table tbody td:first-child {
  text-align: left;
}
.sens-table tbody tr:last-child td { border-bottom: none; }

/* 1%ãƒ»2%ãƒ»3%ãƒ»4%ãƒ»5% ã®è¡Œã‚’åŒºåˆ‡ã‚Šç·šã§å¼·èª¿ */
.sens-table tbody tr.int-border td { border-top: 1px solid var(--border2); }

/* ãƒ’ãƒ¼ãƒˆã‚«ãƒ©ãƒ¼ã¯å»ƒæ­¢ â€” å¹´åˆ©ãƒ»è¿”æ¸ˆé¡åˆ—ã¯è‰²ãªã— */

/* å¿…è¦å¹´åã‚«ãƒ©ãƒ¼ */
.yr-lo { color: #6ec496; }
.yr-md { color: #f0a840; }
.yr-hi { color: #e07080; }

/* â”€â”€ INFO â”€â”€ */
.info-box {
  background: rgba(74,158,255,0.05); border: 1px solid rgba(74,158,255,0.2);
  border-radius: 5px; padding: 11px 13px; margin: 0 0 14px;
  font-size: 0.66rem; color: var(--text2); line-height: 1.7;
}

/* â”€â”€ FOOTER â”€â”€ */
.footer-links {
  margin-top: 32px; padding: 18px 0 40px;
  border-top: 1px solid var(--border); text-align: center;
}
.external-link {
  display: inline-flex; align-items: center; gap: 5px;
  font-size: 0.72rem; color: var(--muted); text-decoration: none; transition: color 0.2s;
}
.external-link:hover { color: var(--gold); }
.external-link::before { content: 'ğŸ”—'; font-size: 0.75rem; }

@media (max-width: 500px) {
  .hero h1 { font-size: 2.4rem; }
}
</style>
</head>
<body>

<div class="hero">
  <div class="hero-bg"></div>
  <div class="hero-grid"></div>
  <div class="hero-inner">
    <a href="mortgage_calculator.html" class="hero-back">ãƒ­ãƒ¼ãƒ³ç®¡ç†ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</a>
    <div class="hero-label">MONTHLY PAYMENT SIMULATOR</div>
    <h1>è¿”æ¸ˆé¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
  </div>
</div>

<div class="main">
  <div class="panel">
    <div class="panel-title">åŸºæœ¬æ¡ä»¶ã®å…¥åŠ›</div>

    <div class="form-row">
      <div class="form-group">
        <label>å€Ÿå…¥é‡‘é¡ï¼ˆä¸‡å††ï¼‰</label>
        <input type="number" id="principal" value="4700" inputmode="decimal" min="100">
      </div>
      <div class="form-group">
        <label>è¿”æ¸ˆæœŸé–“ï¼ˆå¹´ï¼‰</label>
        <input type="number" id="years" value="35" min="1" max="50" inputmode="numeric">
      </div>
      <div class="form-group">
        <label>è¿”æ¸ˆæ–¹å¼</label>
        <select id="method">
          <option value="equal_payment">å…ƒåˆ©å‡ç­‰</option>
          <option value="equal_principal">å…ƒé‡‘å‡ç­‰</option>
        </select>
      </div>
    </div>

    <div class="rateset-label">ç›®æ¨™è¿”æ¸ˆç‡ï¼ˆæœ€å¤§3ã¤ï¼‰</div>
    <p class="rateset-desc">å„é‡‘åˆ©ã§ã®æœˆè¿”æ¸ˆé¡ã‚’ã‚‚ã¨ã«ã€ã“ã®è¿”æ¸ˆç‡ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«å¿…è¦ãªå¹´åã‚’ç®—å‡ºã—ã¾ã™ã€‚</p>
    <div class="rateset-row" id="ratesetRow"></div>
    <button class="rateset-add" id="ratesetAddBtn" onclick="addRateset()" style="margin-top:8px;">
      ï¼‹ è¿”æ¸ˆç‡ã‚’è¿½åŠ 
    </button>

    <button class="btn-calc" onclick="calculate()">ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ç”Ÿæˆã™ã‚‹</button>
  </div>

  <div id="tablePanel">
    <div class="section-label">é‡‘åˆ©åˆ¥ æœˆè¿”æ¸ˆé¡ãƒ»å¿…è¦å¹´å ä¸€è¦§</div>
    <div class="info-box" id="tableDesc"></div>
    <div class="panel" style="padding:0; overflow:hidden;">
      <div class="sens-outer" id="sensOuter">
        <table class="sens-table" id="sensTable"></table>
      </div>
    </div>
    <div id="variableNote" style="display:none;font-size:0.6rem;color:var(--muted);margin-top:-6px;margin-bottom:14px;padding-left:2px;">
      â€» å…ƒé‡‘å‡ç­‰ã®æœˆè¿”æ¸ˆé¡ã¯åˆæœˆï¼ˆæœ€å¤§å€¤ï¼‰ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ä»¥é™ã¯æ¯æœˆå°‘ã—ãšã¤æ¸›ã‚Šã¾ã™ã€‚
    </div>
  </div>
</div>

<footer class="footer-links">
  <a href="mortgage_calculator.html" class="external-link">
    è¿”æ¸ˆç®¡ç†ãƒ»ç¹°ã‚Šä¸Šã’è¿”æ¸ˆãƒ»å£²å´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã“ã¡ã‚‰
  </a>
</footer>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const RS_COLORS = ['#4a9eff', '#6ec496', '#f0c060'];

let ratesets = [
  { id: 0, pct: 20 },
  { id: 1, pct: 25 },
  { id: 2, pct: 30 },
];
let nextRsId = 3;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RATESET UI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addRateset() {
  if (ratesets.length >= 3) return;
  const defaults = [20, 25, 30];
  ratesets.push({ id: nextRsId++, pct: defaults[ratesets.length] || 30 });
  renderRatesets();
}
function removeRateset(id) {
  if (ratesets.length <= 1) return;
  ratesets = ratesets.filter(r => r.id !== id);
  renderRatesets();
}
function renderRatesets() {
  document.getElementById('ratesetRow').innerHTML = ratesets.map((rs, i) => {
    const color = RS_COLORS[i];
    return `<div class="rateset-item">
      <div class="rateset-color" style="background:${color}"></div>
      <input class="rateset-input" type="number" value="${rs.pct}"
        min="1" max="50" step="1" inputmode="numeric"
        oninput="ratesets[${i}].pct = Math.min(50, Math.max(1, parseInt(this.value) || 1))">
      <span class="rateset-pct">%</span>
      ${ratesets.length > 1
        ? `<button class="rateset-del" onclick="removeRateset(${rs.id})">âœ•</button>`
        : ''}
    </div>`;
  }).join('');
  document.getElementById('ratesetAddBtn').style.display =
    ratesets.length >= 3 ? 'none' : 'flex';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALCULATION CORE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function calcPMT(P, r, n) {
  if (r === 0) return P / n;
  return P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
}

/**
 * æœˆè¿”æ¸ˆé¡ï¼ˆåˆæœˆï¼‰ã¨ç·æ”¯æ‰•é¡ã‚’è¿”ã™
 * å…ƒåˆ©å‡ç­‰: æ¯æœˆå‡ä¸€ï¼ˆç«¯æ•°èª¿æ•´ï¼‰
 * å…ƒé‡‘å‡ç­‰: åˆæœˆã®ã¿è¿”ã™ï¼ˆä»¥é™é€“æ¸›ï¼‰
 */
function calcMonthly(P, yearlyRate, years, method) {
  const r = yearlyRate / 100 / 12;
  const n = years * 12;

  if (method === 'equal_payment') {
    const pmt = Math.floor(calcPMT(P, r, n));
    // ç·æ”¯æ‰•: pmt Ã— n + æœ€çµ‚æœˆã®ç«¯æ•°ï¼ˆå…ƒæœ¬ã®ä½™ã‚Šï¼‰
    let bal = P, totalPay = 0;
    for (let i = 1; i <= n; i++) {
      const interest = Math.floor(bal * r);
      const principal = i === n ? bal : pmt - interest;
      totalPay += interest + principal;
      bal = Math.max(0, bal - principal);
    }
    return { first: pmt, totalPay: Math.round(totalPay), variable: false };
  } else {
    const principalPerMonth = Math.floor(P / n);
    let bal = P, totalPay = 0, firstPmt = null;
    for (let i = 1; i <= n; i++) {
      const interest = Math.floor(bal * r);
      const actualPrincipal = i === n ? bal : principalPerMonth;
      const pmt = actualPrincipal + interest;
      if (!firstPmt) firstPmt = pmt;
      totalPay += pmt;
      bal = Math.max(0, bal - actualPrincipal);
    }
    return { first: firstPmt, totalPay: Math.round(totalPay), variable: true };
  }
}

/** æœˆè¿”æ¸ˆé¡ã‹ã‚‰å¿…è¦å¹´åï¼ˆä¸‡å††ãƒ»åˆ‡ã‚Šä¸Šã’ï¼‰ã‚’è¨ˆç®— */
function reqIncome(monthly, pct) {
  return Math.ceil((monthly * 12) / (pct / 100) / 10000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INCOME COLOR by value
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function incomeClass(val) {
  if (val <= 600) return 'yr-lo';
  if (val <= 800) return 'yr-md';
  return 'yr-hi';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GENERATE TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function calculate() {
  const P      = parseFloat(document.getElementById('principal').value) * 10000;
  const years  = parseInt(document.getElementById('years').value);
  const method = document.getElementById('method').value;
  if (!P || !years || P < 0) return;

  // 0.1 ã€œ 5.0% ã‚’ 0.1% åˆ»ã¿ â†’ 50è¡Œ
  const rates = [];
  for (let i = 1; i <= 50; i++) {
    rates.push(Math.round(i * 10) / 100); // æµ®å‹•å°æ•°ç‚¹èª¤å·®é˜²æ­¢
  }

  // â”€â”€ ãƒ˜ãƒƒãƒ€ãƒ¼æ§‹ç¯‰ â”€â”€
  const rsHeaders = ratesets.map((rs, j) =>
    `<th class="th-sep th-r${j}">è¿”æ¸ˆç‡${rs.pct}%<br>ã®å¿…è¦å¹´å</th>`
  ).join('');

  // â”€â”€ è¡Œæ§‹ç¯‰ â”€â”€
  const tbody = rates.map(rate => {
    const { first, totalPay, variable } = calcMonthly(P, rate, years, method);
    const varMark = variable
      ? '<span style="font-size:0.56rem;color:var(--muted)">ã€œ</span>'
      : '';

    // æ•´æ•°é‡‘åˆ©ã®è¡Œã«ä¸Šç½«ç·š
    const isInt = Number.isInteger(rate);

    const incomeCells = ratesets.map((rs, j) => {
      const inc = reqIncome(first, rs.pct);
      return `<td class="td-sep ${incomeClass(inc)}">${inc.toLocaleString('ja-JP')}<span style="font-size:0.58rem;color:var(--muted)">ä¸‡å††ã€œ</span></td>`;
    }).join('');

    return `<tr${isInt ? ' class="int-border"' : ''}>
      <td><span style="font-family:'DM Mono',monospace;font-weight:600;">${rate.toFixed(1)}%</span></td>
      <td>${first.toLocaleString('ja-JP')}å††${varMark}</td>
      <td>${Math.round(totalPay / 10000).toLocaleString('ja-JP')}ä¸‡å††</td>
      ${incomeCells}
    </tr>`;
  }).join('');

  document.getElementById('sensTable').innerHTML = `
    <thead>
      <tr>
        <th style="text-align:left;">å¹´åˆ©</th>
        <th>æœˆè¿”æ¸ˆé¡</th>
        <th>ç·æ”¯æ‰•é¡</th>
        ${rsHeaders}
      </tr>
    </thead>
    <tbody>${tbody}</tbody>
  `;

  // èª¬æ˜æ–‡
  const methodLabel = method === 'equal_payment' ? 'å…ƒåˆ©å‡ç­‰' : 'å…ƒé‡‘å‡ç­‰';
  document.getElementById('tableDesc').innerHTML =
    `å€Ÿå…¥ <strong>${(P / 10000).toLocaleString('ja-JP')}ä¸‡å††</strong>ãƒ»è¿”æ¸ˆæœŸé–“ <strong>${years}å¹´</strong>ãƒ»<strong>${methodLabel}</strong> ã§ã®è©¦ç®—ã§ã™ã€‚`
    + (method === 'equal_principal'
      ? 'ã€€æœˆè¿”æ¸ˆé¡ã¯åˆæœˆï¼ˆæœ€å¤§å€¤ï¼‰ã‚’è¡¨ç¤ºã€‚'
      : '');

  // å…ƒé‡‘å‡ç­‰æ³¨è¨˜
  document.getElementById('variableNote').style.display =
    method === 'equal_principal' ? 'block' : 'none';

  document.getElementById('tablePanel').classList.add('visible');

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å…ˆé ­ã«æˆ»ã™
  document.getElementById('sensOuter').scrollTop = 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
renderRatesets();
window.addEventListener('load', calculate);
['principal', 'years', 'method'].forEach(id => {
  document.getElementById(id).addEventListener('change', calculate);
});
</script>
</body>
</html>
